<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ«æ«ç”µç«ä¿±ä¹éƒ¨</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="apple-touch-icon" sizes="180x180" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ®</text></svg>">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ®</text></svg>">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        :root {
            --primary-color: #ff3366;
            --secondary-color: #4dabf7;
            --success-color: #40c057;
            --warning-color: #ffcc00;
            --bg-dark: #0c0c0c;
            --bg-card: rgba(30, 30, 46, 0.95);
            --text-light: #f0f0f0;
            --text-gray: #aaa;
        }
        
        body {
            background: linear-gradient(135deg, var(--bg-dark) 0%, #1a1a2e 100%);
            color: var(--text-light);
            min-height: 100vh;
            padding: 15px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px 10px;
            border-bottom: 2px solid var(--primary-color);
            position: relative;
        }
        
        h1 {
            color: var(--primary-color);
            font-size: 1.8rem;
            margin-bottom: 8px;
            text-shadow: 0 2px 5px rgba(255, 51, 102, 0.3);
            font-weight: 700;
        }
        
        .subtitle {
            color: var(--text-gray);
            font-size: 0.95rem;
        }
        
        .mobile-controls {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }
        
        .mobile-tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 4px;
            margin-bottom: 15px;
        }
        
        .tab-btn {
            flex: 1;
            padding: 12px 10px;
            border: none;
            background: transparent;
            color: var(--text-gray);
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        
        .tab-btn.active {
            background: rgba(255, 51, 102, 0.2);
            color: var(--primary-color);
        }
        
        .card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }
        
        .card-title {
            display: flex;
            align-items: center;
            color: var(--secondary-color);
            font-size: 1.2rem;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .card-title i {
            margin-right: 8px;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            color: var(--text-light);
            font-weight: 500;
            font-size: 0.95rem;
        }
        
        .optional {
            color: var(--text-gray);
            font-weight: normal;
            font-size: 0.85rem;
        }
        
        .required {
            color: var(--primary-color);
            font-weight: bold;
        }
        
        input, select {
            width: 100%;
            padding: 14px;
            background: rgba(255, 255, 255, 0.07);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            color: var(--text-light);
            font-size: 1rem;
            transition: all 0.3s;
            -webkit-appearance: none;
            appearance: none;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(77, 171, 247, 0.2);
        }
        
        .price-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 10px;
        }
        
        .price-btn {
            padding: 12px 6px;
            background: rgba(255, 255, 255, 0.07);
            border: 2px solid rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            color: var(--text-light);
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .price-btn:hover, .price-btn:active {
            background: rgba(77, 171, 247, 0.2);
            border-color: var(--secondary-color);
        }
        
        .price-btn.selected {
            background: rgba(77, 171, 247, 0.4);
            border-color: var(--secondary-color);
            color: white;
            box-shadow: 0 0 10px rgba(77, 171, 247, 0.5);
        }
        
        /* ä¿®æ”¹æ—¶é—´è¾“å…¥ç»„å¸ƒå±€ */
        .time-input-group {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .time-input-group input {
            flex: 1;
            min-width: 0; /* é˜²æ­¢å†…å®¹æº¢å‡º */
        }
        
        .time-input-group .btn-small {
            width: auto;
            min-width: 70px; /* ç»™æŒ‰é’®ä¸€ä¸ªæœ€å°å®½åº¦ */
            padding: 10px 12px;
            font-size: 0.85rem;
            flex-shrink: 0; /* é˜²æ­¢æŒ‰é’®è¢«å‹ç¼© */
            white-space: nowrap; /* é˜²æ­¢æ–‡å­—æ¢è¡Œ */
        }
        
        .btn {
            padding: 14px 20px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            margin-bottom: 10px;
        }
        
        .btn:active {
            transform: scale(0.98);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), #ff6b6b);
            color: white;
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .btn-add {
            background: linear-gradient(135deg, var(--success-color), #51cf66);
            color: white;
        }
        
        .btn-time {
            background: linear-gradient(135deg, var(--secondary-color), #339af0);
            color: white;
        }
        
        .btn-small {
            padding: 10px 15px;
            font-size: 0.9rem;
        }
        
        .button-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 10px;
        }
        
        .results {
            margin-top: 20px;
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid var(--primary-color);
        }
        
        .results h3 {
            color: var(--warning-color);
            margin-bottom: 12px;
            font-size: 1.1rem;
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px dashed rgba(255, 255, 255, 0.1);
        }
        
        .result-value {
            font-weight: bold;
            color: var(--secondary-color);
        }
        
        .pending-orders {
            max-height: 50vh;
            overflow-y: auto;
            margin-top: 15px;
            -webkit-overflow-scrolling: touch;
        }
        
        .order-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 12px;
            border-left: 4px solid var(--warning-color);
        }
        
        .order-item.completed {
            border-left-color: var(--success-color);
        }
        
        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .order-title {
            font-weight: bold;
            color: var(--warning-color);
            font-size: 1rem;
        }
        
        .order-item.completed .order-title {
            color: var(--success-color);
        }
        
        .order-status {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: bold;
        }
        
        .status-pending {
            background-color: rgba(255, 204, 0, 0.2);
            color: var(--warning-color);
        }
        
        .status-completed {
            background-color: rgba(64, 192, 87, 0.2);
            color: var(--success-color);
        }
        
        .order-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-bottom: 12px;
        }
        
        .order-detail {
            display: flex;
            flex-direction: column;
        }
        
        .detail-label {
            font-size: 0.8rem;
            color: var(--text-gray);
            margin-bottom: 3px;
        }
        
        .detail-value {
            font-weight: 500;
            color: var(--text-light);
            font-size: 0.9rem;
        }
        
        .order-actions {
            display: flex;
            gap: 6px;
            justify-content: flex-end;
            margin-bottom: 12px;
        }
        
        .action-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .edit-btn {
            background-color: var(--secondary-color);
            color: white;
        }
        
        .complete-btn {
            background-color: var(--success-color);
            color: white;
        }
        
        .delete-btn {
            background-color: #ff6b6b;
            color: white;
        }
        
        .copy-text {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 12px;
            margin-top: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            font-family: 'Menlo', 'Monaco', 'Courier New', monospace;
            font-size: 0.85rem;
            line-height: 1.4;
            white-space: pre-wrap;
            position: relative;
            user-select: text;
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
        }
        
        .copy-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(77, 171, 247, 0.3);
            border: 1px solid var(--secondary-color);
            color: var(--secondary-color);
            padding: 4px 8px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.75rem;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 3px;
        }
        
        .copy-btn:active {
            transform: scale(0.95);
        }
        
        /* å¤åˆ¶æŒ‰é’®æˆåŠŸæ ·å¼ */
        .copy-btn.copied, .copy-format-btn.copied {
            background: rgba(64, 192, 87, 0.3) !important;
            border-color: var(--success-color) !important;
            color: var(--success-color) !important;
        }
        
        /* æ–°å¢åŠ å¤åˆ¶æŒ‰é’®ç»„æ ·å¼ */
        .copy-buttons {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }
        
        .copy-format-btn {
            flex: 1;
            padding: 10px;
            background: rgba(77, 171, 247, 0.2);
            border: 1px solid var(--secondary-color);
            color: var(--secondary-color);
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            transition: all 0.2s;
        }
        
        .copy-format-btn:active {
            transform: scale(0.98);
            background: rgba(77, 171, 247, 0.4);
        }
        
        /* è€æ¿æ¶ˆè´¹ç»Ÿè®¡æ ·å¼ */
        .boss-statistics {
            margin-top: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            border-left: 4px solid var(--warning-color);
        }
        
        .boss-statistics h3 {
            color: var(--warning-color);
            margin-bottom: 12px;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .boss-statistics h3 i {
            color: var(--warning-color);
        }
        
        .boss-stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px dashed rgba(255, 255, 255, 0.1);
        }
        
        .boss-name {
            font-weight: 500;
            color: var(--text-light);
            cursor: pointer;
            transition: all 0.2s;
            padding: 4px 8px;
            border-radius: 5px;
        }
        
        .boss-name:hover {
            background: rgba(77, 171, 247, 0.1);
            color: var(--secondary-color);
        }
        
        .boss-total {
            font-weight: bold;
            color: var(--success-color);
        }
        
        .boss-total-amount {
            font-weight: bold;
            color: var(--primary-color);
            font-size: 1.1rem;
        }
        
        .no-statistics {
            text-align: center;
            padding: 20px;
            color: var(--text-gray);
            font-style: italic;
        }
        
        /* è€æ¿è¯¦æƒ…æ¨¡æ€æ¡†æ ·å¼ */
        .boss-detail-modal .modal-content {
            max-width: 600px;
        }
        
        .boss-orders-list {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
            -webkit-overflow-scrolling: touch;
        }
        
        .boss-order-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            border-left: 4px solid var(--warning-color);
        }
        
        .boss-order-item.completed {
            border-left-color: var(--success-color);
        }
        
        .boss-order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .boss-order-title {
            font-weight: bold;
            color: var(--warning-color);
            font-size: 0.95rem;
        }
        
        .boss-order-item.completed .boss-order-title {
            color: var(--success-color);
        }
        
        .boss-order-status {
            padding: 3px 8px;
            border-radius: 15px;
            font-size: 0.7rem;
            font-weight: bold;
        }
        
        .boss-order-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 6px;
            margin-bottom: 8px;
        }
        
        .boss-order-detail {
            display: flex;
            flex-direction: column;
        }
        
        .boss-detail-label {
            font-size: 0.75rem;
            color: var(--text-gray);
            margin-bottom: 2px;
        }
        
        .boss-detail-value {
            font-weight: 500;
            color: var(--text-light);
            font-size: 0.85rem;
        }
        
        footer {
            text-align: center;
            margin-top: 30px;
            color: var(--text-gray);
            font-size: 0.8rem;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .current-time {
            text-align: center;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 1rem;
        }
        
        .current-time span {
            color: var(--secondary-color);
            font-weight: bold;
        }
        
        .no-orders {
            text-align: center;
            padding: 30px 15px;
            color: var(--text-gray);
        }
        
        .no-orders i {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: rgba(255, 255, 255, 0.1);
        }
        
        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal-content {
            background: var(--bg-card);
            border-radius: 15px;
            padding: 25px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            border: 2px solid var(--primary-color);
            -webkit-overflow-scrolling: touch;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .modal-title {
            color: var(--warning-color);
            font-size: 1.3rem;
        }
        
        .close-btn {
            background: none;
            border: none;
            color: var(--text-gray);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 5px;
        }
        
        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 480px) {
            .price-buttons {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .order-details {
                grid-template-columns: 1fr;
            }
            
            .boss-order-details {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 1.6rem;
            }
            
            .btn {
                padding: 12px 16px;
                font-size: 0.95rem;
            }
            
            /* åœ¨æ‰‹æœºä¸Šè¿›ä¸€æ­¥ç¼©å°æ—¶é—´æŒ‰é’® */
            .time-input-group .btn-small {
                min-width: 60px;
                padding: 10px 8px;
                font-size: 0.8rem;
            }
            
            .copy-buttons {
                flex-direction: column;
            }
        }
        
        @media (min-width: 768px) {
            .container {
                max-width: 700px;
            }
            
            .button-group {
                flex-direction: row;
                flex-wrap: wrap;
            }
            
            .btn {
                width: auto;
                flex: 1;
            }
            
            /* åœ¨æ¡Œé¢ç«¯è°ƒæ•´æ—¶é—´è¾“å…¥ç»„ */
            .time-input-group .btn-small {
                min-width: 80px;
            }
        }
        
        /* è§¦æ‘¸ä¼˜åŒ– */
        .touch-optimized {
            touch-action: manipulation;
        }
        
        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 9999;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="loading" id="loading">
        <div class="loading-spinner"></div>
        <p style="margin-top: 20px; color: white;">åŠ è½½ä¸­...</p>
    </div>
    
    <div class="container">
        <header>
            <h1><i class="fas fa-gamepad"></i> æ«æ«ç”µç«ä¿±ä¹éƒ¨</h1>
            <p class="subtitle">ä¸“ä¸šç”µç«è®¡æ—¶ä¸è´¹ç”¨è®¡ç®—ç³»ç»Ÿ</p>
            
            <div class="current-time">
                å½“å‰æ—¶é—´: <span id="current-time">--:--:--</span>
            </div>
        </header>
        
        <div class="mobile-tabs">
            <button class="tab-btn active" id="tab-new">
                <i class="fas fa-plus-circle"></i> æ–°å»ºè®¢å•
            </button>
            <button class="tab-btn" id="tab-pending">
                <i class="fas fa-history"></i> å¾…ç»“æŸè®¢å•
                <span class="order-count" id="pending-count">0</span>
            </button>
        </div>
        
        <!-- æ–°å»ºè®¢å•å¡ç‰‡ -->
        <div class="card" id="new-order-card">
            <h2 class="card-title"><i class="fas fa-calculator"></i> æ–°å»ºè®¡æ—¶è®¢å•</h2>
            
            <div class="input-group">
                <label><i class="fas fa-money-bill-wave"></i> æ¯å°æ—¶å•ä»·ï¼ˆå…ƒï¼‰ <span class="optional">(å¯é€‰)</span></label>
                <div class="price-buttons" id="price-buttons">
                    <button class="price-btn" data-price="55">55</button>
                    <button class="price-btn" data-price="60">60</button>
                    <button class="price-btn" data-price="65">65</button>
                    <button class="price-btn" data-price="70">70</button>
                    <button class="price-btn" data-price="75">75</button>
                    <button class="price-btn" data-price="80">80</button>
                    <button class="price-btn" data-price="90">90</button>
                    <button class="price-btn" data-price="100">100</button>
                </div>
                <input type="number" id="price-per-hour" min="0" step="1" placeholder="æˆ–æ‰‹åŠ¨è¾“å…¥å…¶ä»–å•ä»·" inputmode="decimal">
            </div>
            
            <div class="input-group">
                <label for="companion-name"><i class="fas fa-user"></i> é™ªç©åç§° <span class="optional">(å¯é€‰)</span></label>
                <input type="text" id="companion-name" placeholder="è¯·è¾“å…¥é™ªç©åç§°ï¼ˆå¯é€‰ï¼‰">
            </div>
            
            <div class="input-group">
                <label for="boss-name"><i class="fas fa-crown"></i> è€æ¿åç§° <span class="optional">(å¯é€‰)</span></label>
                <input type="text" id="boss-name" placeholder="è¯·è¾“å…¥è€æ¿åç§°ï¼ˆå¯é€‰ï¼‰">
            </div>
            
            <div class="input-group">
                <label for="start-time"><i class="fas fa-play-circle"></i> å¼€å§‹æ—¶é—´ <span class="required">*</span></label>
                <div class="time-input-group">
                    <input type="datetime-local" id="start-time">
                    <button id="set-now-btn" class="btn btn-secondary btn-small">ç°åœ¨</button>
                </div>
            </div>
            
            <div class="input-group">
                <label for="end-time"><i class="fas fa-stop-circle"></i> ç»“æŸæ—¶é—´ <span class="optional">(å¯é€‰ï¼Œå¯ç¨åæ·»åŠ )</span></label>
                <div class="time-input-group">
                    <input type="datetime-local" id="end-time">
                    <button id="set-current-btn" class="btn btn-secondary btn-small">å½“å‰</button>
                </div>
            </div>
            
            <div class="button-group">
                <button id="add-to-pending-btn" class="btn btn-add"><i class="fas fa-plus-circle"></i> æ·»åŠ åˆ°å¾…ç»“æŸ</button>
                <button id="calculate-time-btn" class="btn btn-time"><i class="fas fa-clock"></i> è®¡ç®—æ—¶é•¿</button>
                <button id="calculate-cost-btn" class="btn btn-primary"><i class="fas fa-calculator"></i> è®¡ç®—è´¹ç”¨</button>
                <button id="reset-btn" class="btn btn-secondary"><i class="fas fa-redo"></i> é‡ç½®</button>
            </div>
            
            <div id="time-results" class="results" style="display:none;">
                <h3><i class="fas fa-clock"></i> æ—¶é•¿è®¡ç®—ç»“æœ</h3>
                <div class="result-item">
                    <span>å®é™…æ—¶é•¿:</span>
                    <span class="result-value" id="time-actual">--</span>
                </div>
                <div class="result-item">
                    <span>è®¡è´¹æ—¶é•¿:</span>
                    <span class="result-value" id="time-billable">--</span>
                </div>
            </div>
            
            <div id="cost-results" class="results" style="display:none;">
                <h3><i class="fas fa-file-invoice-dollar"></i> è´¹ç”¨è®¡ç®—ç»“æœ</h3>
                <div class="result-item">
                    <span>æ€»è´¹ç”¨:</span>
                    <span class="result-value highlight" id="cost-total">--</span>
                </div>
            </div>
        </div>
        
        <!-- å¾…ç»“æŸè®¢å•å¡ç‰‡ -->
        <div class="card" id="pending-orders-card" style="display:none;">
            <h2 class="card-title"><i class="fas fa-history"></i> å¾…ç»“æŸè®¢å•</h2>
            
            <div class="pending-orders" id="pending-orders-container">
                <div class="no-orders" id="no-orders">
                    <i class="fas fa-clipboard-list"></i>
                    <p>æš‚æ— å¾…ç»“æŸè®¢å•</p>
                    <p style="font-size:0.85rem; margin-top:10px; color: rgba(255,255,255,0.6);">æ·»åŠ æ–°çš„è®¢å•åï¼Œå°†åœ¨è¿™é‡Œæ˜¾ç¤º</p>
                </div>
            </div>
            
            <!-- è€æ¿æ¶ˆè´¹ç»Ÿè®¡åŒºåŸŸ -->
            <div id="boss-statistics-container">
                <!-- è¿™é‡Œé€šè¿‡JSåŠ¨æ€ç”Ÿæˆè€æ¿æ¶ˆè´¹ç»Ÿè®¡ -->
            </div>
            
            <div class="button-group" style="margin-top: 20px;">
                <button id="clear-all-btn" class="btn btn-secondary"><i class="fas fa-trash-alt"></i> æ¸…é™¤æ‰€æœ‰</button>
                <button id="export-btn" class="btn btn-secondary"><i class="fas fa-file-export"></i> å¯¼å‡ºæ•°æ®</button>
            </div>
        </div>
    </div>
    
    <!-- ç¼–è¾‘è®¢å•æ¨¡æ€æ¡† -->
    <div class="modal" id="edit-order-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-edit"></i> ç¼–è¾‘è®¢å•</h3>
                <button class="close-btn" id="close-edit-modal">&times;</button>
            </div>
            
            <div class="input-group">
                <label><i class="fas fa-money-bill-wave"></i> æ¯å°æ—¶å•ä»·ï¼ˆå…ƒï¼‰</label>
                <div class="price-buttons" id="edit-price-buttons">
                    <button class="price-btn" data-price="55">55</button>
                    <button class="price-btn" data-price="60">60</button>
                    <button class="price-btn" data-price="65">65</button>
                    <button class="price-btn" data-price="70">70</button>
                    <button class="price-btn" data-price="75">75</button>
                    <button class="price-btn" data-price="80">80</button>
                    <button class="price-btn" data-price="90">90</button>
                    <button class="price-btn" data-price="100">100</button>
                </div>
                <input type="number" id="edit-price-per-hour" min="0" step="1" placeholder="æˆ–æ‰‹åŠ¨è¾“å…¥å…¶ä»–å•ä»·" inputmode="decimal">
            </div>
            
            <div class="input-group">
                <label for="edit-companion-name"><i class="fas fa-user"></i> é™ªç©åç§°</label>
                <input type="text" id="edit-companion-name" placeholder="è¯·è¾“å…¥é™ªç©åç§°ï¼ˆå¯é€‰ï¼‰">
            </div>
            
            <div class="input-group">
                <label for="edit-boss-name"><i class="fas fa-crown"></i> è€æ¿åç§°</label>
                <input type="text" id="edit-boss-name" placeholder="è¯·è¾“å…¥è€æ¿åç§°ï¼ˆå¯é€‰ï¼‰">
            </div>
            
            <div class="input-group">
                <label for="edit-start-time"><i class="fas fa-play-circle"></i> å¼€å§‹æ—¶é—´</label>
                <input type="datetime-local" id="edit-start-time">
            </div>
            
            <div class="input-group">
                <label for="edit-end-time"><i class="fas fa-stop-circle"></i> ç»“æŸæ—¶é—´</label>
                <div class="time-input-group">
                    <input type="datetime-local" id="edit-end-time">
                    <button id="edit-set-current-btn" class="btn btn-secondary btn-small">è®¾ä¸ºå½“å‰</button>
                </div>
            </div>
            
            <div class="button-group" style="margin-top: 20px;">
                <button id="edit-complete-btn" class="btn btn-add"><i class="fas fa-check-circle"></i> ç»“æŸè®¢å•</button>
                <button id="save-edit-btn" class="btn btn-primary"><i class="fas fa-save"></i> ä¿å­˜ä¿®æ”¹</button>
                <button id="cancel-edit-btn" class="btn btn-secondary"><i class="fas fa-times"></i> å–æ¶ˆ</button>
            </div>
        </div>
    </div>
    
    <!-- è€æ¿è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div class="modal boss-detail-modal" id="boss-detail-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-user-tie"></i> <span id="boss-detail-name">è€æ¿è¯¦æƒ…</span></h3>
                <button class="close-btn" id="close-boss-detail-modal">&times;</button>
            </div>
            
            <div class="result-item">
                <span>è®¢å•æ€»æ•°:</span>
                <span class="result-value" id="boss-total-orders">0</span>
            </div>
            <div class="result-item">
                <span>å·²å®Œæˆè®¢å•:</span>
                <span class="result-value" id="boss-completed-orders">0</span>
            </div>
            <div class="result-item">
                <span>è¿›è¡Œä¸­è®¢å•:</span>
                <span class="result-value" id="boss-pending-orders">0</span>
            </div>
            <div class="result-item">
                <span>æ€»æ¶ˆè´¹é‡‘é¢:</span>
                <span class="result-value" id="boss-total-cost">0.00å…ƒ</span>
            </div>
            
            <h4 style="margin-top: 20px; margin-bottom: 10px; color: var(--secondary-color);">
                <i class="fas fa-list"></i> è®¢å•è¯¦æƒ…
            </h4>
            
            <div class="boss-orders-list" id="boss-orders-list">
                <!-- è¿™é‡Œé€šè¿‡JSåŠ¨æ€ç”Ÿæˆè€æ¿çš„è®¢å•åˆ—è¡¨ -->
            </div>
            
            <div class="button-group" style="margin-top: 20px;">
                <button id="close-boss-detail-btn" class="btn btn-secondary">å…³é—­</button>
            </div>
        </div>
    </div>
    
    <footer>
        <p>æ«æ«ç”µç«ä¿±ä¹éƒ¨ &copy; 2023 | æ‰‹æœºç‰ˆè®¡æ—¶è®¡è´¹ç³»ç»Ÿ</p>
        <p style="margin-top: 8px; font-size: 0.7rem; color: rgba(255,255,255,0.5);">æ•°æ®ä¿å­˜åœ¨æœ¬åœ°æµè§ˆå™¨ä¸­</p>
    </footer>
    
    <script>
        // æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
        document.getElementById('loading').style.display = 'flex';
        
        // DOMå…ƒç´ 
        const currentTimeEl = document.getElementById('current-time');
        const pricePerHourEl = document.getElementById('price-per-hour');
        const companionNameEl = document.getElementById('companion-name');
        const bossNameEl = document.getElementById('boss-name');
        const startTimeEl = document.getElementById('start-time');
        const endTimeEl = document.getElementById('end-time');
        const setNowBtn = document.getElementById('set-now-btn');
        const setCurrentBtn = document.getElementById('set-current-btn');
        const addToPendingBtn = document.getElementById('add-to-pending-btn');
        const calculateTimeBtn = document.getElementById('calculate-time-btn');
        const calculateCostBtn = document.getElementById('calculate-cost-btn');
        const resetBtn = document.getElementById('reset-btn');
        const timeResults = document.getElementById('time-results');
        const costResults = document.getElementById('cost-results');
        const pendingOrdersContainer = document.getElementById('pending-orders-container');
        const noOrdersEl = document.getElementById('no-orders');
        const priceButtons = document.querySelectorAll('#price-buttons .price-btn');
        const pendingCountEl = document.getElementById('pending-count');
        const bossStatisticsContainer = document.getElementById('boss-statistics-container');
        
        // è€æ¿è¯¦æƒ…æ¨¡æ€æ¡†å…ƒç´ 
        const bossDetailModal = document.getElementById('boss-detail-modal');
        const bossDetailNameEl = document.getElementById('boss-detail-name');
        const bossTotalOrdersEl = document.getElementById('boss-total-orders');
        const bossCompletedOrdersEl = document.getElementById('boss-completed-orders');
        const bossPendingOrdersEl = document.getElementById('boss-pending-orders');
        const bossTotalCostEl = document.getElementById('boss-total-cost');
        const bossOrdersListEl = document.getElementById('boss-orders-list');
        const closeBossDetailModalBtn = document.getElementById('close-boss-detail-modal');
        const closeBossDetailBtn = document.getElementById('close-boss-detail-btn');
        
        // æ ‡ç­¾é¡µå…ƒç´ 
        const tabNewBtn = document.getElementById('tab-new');
        const tabPendingBtn = document.getElementById('tab-pending');
        const newOrderCard = document.getElementById('new-order-card');
        const pendingOrdersCard = document.getElementById('pending-orders-card');
        
        // æ¨¡æ€æ¡†å…ƒç´ 
        const editOrderModal = document.getElementById('edit-order-modal');
        const closeEditModalBtn = document.getElementById('close-edit-modal');
        const cancelEditBtn = document.getElementById('cancel-edit-btn');
        const saveEditBtn = document.getElementById('save-edit-btn');
        const editCompleteBtn = document.getElementById('edit-complete-btn');
        const editPricePerHourEl = document.getElementById('edit-price-per-hour');
        const editCompanionNameEl = document.getElementById('edit-companion-name');
        const editBossNameEl = document.getElementById('edit-boss-name');
        const editStartTimeEl = document.getElementById('edit-start-time');
        const editEndTimeEl = document.getElementById('edit-end-time');
        const editSetCurrentBtn = document.getElementById('edit-set-current-btn');
        const editPriceButtons = document.querySelectorAll('#edit-price-buttons .price-btn');
        
        // å…¨å±€å˜é‡
        let pendingOrders = [];
        let editingOrderId = null;
        let selectedPrice = null;
        let editSelectedPrice = null;
        
        // åˆå§‹åŒ–ï¼šä»localStorageåŠ è½½æ•°æ®
        function loadFromLocalStorage() {
            try {
                const savedOrders = localStorage.getItem('fengfengPendingOrders');
                if (savedOrders) {
                    pendingOrders = JSON.parse(savedOrders);
                    console.log(`ä»localStorageåŠ è½½äº† ${pendingOrders.length} ä¸ªè®¢å•`);
                } else {
                    pendingOrders = [];
                    console.log('localStorageä¸­æ²¡æœ‰è®¢å•æ•°æ®');
                }
            } catch (error) {
                console.error('åŠ è½½localStorageæ•°æ®æ—¶å‡ºé”™:', error);
                pendingOrders = [];
            }
        }
        
        // ä¿å­˜æ•°æ®åˆ°localStorage
        function saveToLocalStorage() {
            try {
                localStorage.setItem('fengfengPendingOrders', JSON.stringify(pendingOrders));
                console.log(`ä¿å­˜äº† ${pendingOrders.length} ä¸ªè®¢å•åˆ°localStorage`);
            } catch (error) {
                console.error('ä¿å­˜åˆ°localStorageæ—¶å‡ºé”™:', error);
            }
        }
        
        // æ ‡ç­¾é¡µåˆ‡æ¢
        tabNewBtn.addEventListener('click', () => {
            tabNewBtn.classList.add('active');
            tabPendingBtn.classList.remove('active');
            newOrderCard.style.display = 'block';
            pendingOrdersCard.style.display = 'none';
        });
        
        tabPendingBtn.addEventListener('click', () => {
            tabPendingBtn.classList.add('active');
            tabNewBtn.classList.remove('active');
            newOrderCard.style.display = 'none';
            pendingOrdersCard.style.display = 'block';
            updatePendingOrdersDisplay();
            updateBossStatistics();
        });
        
        // æ›´æ–°å½“å‰æ—¶é—´æ˜¾ç¤º
        function updateCurrentTime() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            
            currentTimeEl.textContent = `${hours}:${minutes}:${seconds}`;
        }
        
        // åˆå§‹åŒ–æ—¶é—´è¾“å…¥æ¡† - åªè®¾ç½®é»˜è®¤å€¼ï¼Œä¸è¦†ç›–ç”¨æˆ·è¾“å…¥
        function initializeTimes() {
            // åªåœ¨ç¬¬ä¸€æ¬¡åŠ è½½é¡µé¢æ—¶è®¾ç½®é»˜è®¤æ—¶é—´
            // æˆ–è€…å½“ç”¨æˆ·ç‚¹å‡»é‡ç½®æŒ‰é’®æ—¶
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            
            // è®¾ç½®å¼€å§‹æ—¶é—´ä¸º1å°æ—¶å‰ï¼ˆä»…åœ¨è¡¨å•ä¸ºç©ºæ—¶ï¼‰
            if (!startTimeEl.value) {
                const oneHourAgo = new Date(now.getTime() - 60 * 60 * 1000);
                const startHours = String(oneHourAgo.getHours()).padStart(2, '0');
                const startMinutes = String(oneHourAgo.getMinutes()).padStart(2, '0');
                
                const datetimeLocalOneHourAgo = `${year}-${month}-${day}T${startHours}:${startMinutes}`;
                startTimeEl.value = datetimeLocalOneHourAgo;
            }
            
            // ç»“æŸæ—¶é—´é»˜è®¤ä¸ºç©º
            if (!endTimeEl.value) {
                endTimeEl.value = '';
            }
        }
        
        // æ ¹æ®åˆ†é’Ÿè®¡ç®—è®¡è´¹æ—¶é•¿
        function calculateBillableHours(minutes) {
            if (minutes <= 15) return 0;
            if (minutes <= 44) return 0.5;
            return 1;
        }
        
        // è®¡ç®—æ—¶é—´å·®
        function calculateTimeDifference(startTime, endTime = null) {
            const start = new Date(startTime);
            const end = endTime ? new Date(endTime) : new Date();
            
            const diffMs = end - start;
            const diffMinutes = Math.floor(diffMs / (1000 * 60));
            
            if (diffMinutes < 0) {
                return { error: "ç»“æŸæ—¶é—´ä¸èƒ½æ—©äºå¼€å§‹æ—¶é—´" };
            }
            
            const hours = Math.floor(diffMinutes / 60);
            const remainingMinutes = diffMinutes % 60;
            
            // è®¡ç®—æ•´å°æ—¶éƒ¨åˆ†
            let billableHours = hours;
            
            // åŠ ä¸Šå‰©ä½™åˆ†é’Ÿçš„è®¡è´¹æ—¶é•¿
            billableHours += calculateBillableHours(remainingMinutes);
            
            // æ ¼å¼åŒ–æŒç»­æ—¶é—´
            const durationText = `${hours}å°æ—¶${remainingMinutes}åˆ†é’Ÿ`;
            const billableText = `${billableHours}å°æ—¶`;
            
            return {
                actualDuration: durationText,
                billableHours: billableText,
                billableHoursNum: billableHours,
                totalMinutes: diffMinutes,
                hours: hours,
                minutes: remainingMinutes,
                startTime: start,
                endTime: end
            };
        }
        
        // è®¡ç®—è®¢å•è´¹ç”¨
        function calculateOrderCost(order) {
            const timeResult = calculateTimeDifference(order.startTime, order.endTime);
            if (timeResult.error) {
                return 0;
            }
            
            return timeResult.billableHoursNum * (order.pricePerHour || 0);
        }
        
        // æ˜¾ç¤ºè€æ¿è¯¦æƒ…
        function showBossDetails(bossName) {
            // è·å–è¯¥è€æ¿çš„æ‰€æœ‰è®¢å•
            const bossOrders = pendingOrders.filter(order => order.bossName === bossName);
            
            if (bossOrders.length === 0) {
                showToast('è¯¥è€æ¿æ²¡æœ‰è®¢å•', 'info');
                return;
            }
            
            // æ›´æ–°æ¨¡æ€æ¡†æ ‡é¢˜
            bossDetailNameEl.textContent = bossName;
            
            // ç»Ÿè®¡è®¢å•ä¿¡æ¯
            const totalOrders = bossOrders.length;
            const completedOrders = bossOrders.filter(order => order.endTime).length;
            const pendingOrdersCount = totalOrders - completedOrders;
            const totalCost = bossOrders.reduce((sum, order) => sum + calculateOrderCost(order), 0);
            
            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            bossTotalOrdersEl.textContent = totalOrders;
            bossCompletedOrdersEl.textContent = completedOrders;
            bossPendingOrdersEl.textContent = pendingOrdersCount;
            bossTotalCostEl.textContent = `${totalCost.toFixed(2)}å…ƒ`;
            
            // æ¸…ç©ºè®¢å•åˆ—è¡¨
            bossOrdersListEl.innerHTML = '';
            
            // æŒ‰åˆ›å»ºæ—¶é—´å€’åºæ’åº
            const sortedOrders = [...bossOrders].sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            // æ·»åŠ è®¢å•åˆ°åˆ—è¡¨
            sortedOrders.forEach(order => {
                const orderElement = createBossOrderElement(order);
                bossOrdersListEl.appendChild(orderElement);
            });
            
            // æ˜¾ç¤ºæ¨¡æ€æ¡†
            bossDetailModal.style.display = 'flex';
        }
        
        // åˆ›å»ºè€æ¿è®¢å•å…ƒç´ 
        function createBossOrderElement(order) {
            const isCompleted = order.endTime !== null;
            const timeResult = calculateTimeDifference(order.startTime, order.endTime);
            const totalCost = calculateOrderCost(order);
            
            const orderDiv = document.createElement('div');
            orderDiv.className = `boss-order-item ${isCompleted ? 'completed' : ''}`;
            
            const startDate = new Date(order.startTime);
            const dateStr = formatDateForDisplay(startDate);
            const timeStr = formatTimeForDisplay(startDate);
            
            let durationText = 'è¿›è¡Œä¸­';
            let billableText = 'å¾…è®¡ç®—';
            
            if (!timeResult.error) {
                durationText = timeResult.actualDuration;
                billableText = timeResult.billableHours;
            }
            
            orderDiv.innerHTML = `
                <div class="boss-order-header">
                    <div class="boss-order-title">
                        ${dateStr} ${timeStr} - ${order.companionName || 'æœªå¡«å†™'}
                    </div>
                    <div class="boss-order-status ${isCompleted ? 'status-completed' : 'status-pending'}">
                        ${isCompleted ? 'å·²ç»“æŸ' : 'è¿›è¡Œä¸­'}
                    </div>
                </div>
                
                <div class="boss-order-details">
                    <div class="boss-order-detail">
                        <span class="boss-detail-label">é™ªç©</span>
                        <span class="boss-detail-value">${order.companionName || 'æœªå¡«å†™'}</span>
                    </div>
                    <div class="boss-order-detail">
                        <span class="boss-detail-label">æ—¥æœŸ</span>
                        <span class="boss-detail-value">${dateStr}</span>
                    </div>
                    <div class="boss-order-detail">
                        <span class="boss-detail-label">çŠ¶æ€</span>
                        <span class="boss-detail-value ${isCompleted ? 'status-completed' : 'status-pending'}">
                            ${isCompleted ? 'å·²ç»“æŸ' : 'å¾…ç»“æŸ'}
                        </span>
                    </div>
                    <div class="boss-order-detail">
                        <span class="boss-detail-label">æ—¶é•¿</span>
                        <span class="boss-detail-value">${durationText}</span>
                    </div>
                    <div class="boss-order-detail">
                        <span class="boss-detail-label">è®¡è´¹æ—¶é•¿</span>
                        <span class="boss-detail-value">${billableText}</span>
                    </div>
                    <div class="boss-order-detail">
                        <span class="boss-detail-label">å•ä»·</span>
                        <span class="boss-detail-value">${order.pricePerHour > 0 ? `${order.pricePerHour}å…ƒ/å°æ—¶` : 'æœªè®¾ç½®'}</span>
                    </div>
                    <div class="boss-order-detail">
                        <span class="boss-detail-label">è´¹ç”¨</span>
                        <span class="boss-detail-value">${totalCost.toFixed(2)}å…ƒ</span>
                    </div>
                </div>
            `;
            
            return orderDiv;
        }
        
        // æ ¼å¼åŒ–æ—¥æœŸç”¨äºæ˜¾ç¤º
        function formatDateForDisplay(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }
        
        // æ ¼å¼åŒ–æ—¶é—´ç”¨äºæ˜¾ç¤º
        function formatTimeForDisplay(date) {
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            return `${hours}:${minutes}`;
        }
        
        // æ›´æ–°è€æ¿æ¶ˆè´¹ç»Ÿè®¡
        function updateBossStatistics() {
            bossStatisticsContainer.innerHTML = '';
            
            if (pendingOrders.length === 0) {
                return;
            }
            
            // ç»Ÿè®¡æ¯ä¸ªè€æ¿çš„æ¶ˆè´¹æ€»é¢
            const bossStats = {};
            
            pendingOrders.forEach(order => {
                const bossName = order.bossName || 'æ•£å®¢';
                const cost = calculateOrderCost(order);
                
                if (!bossStats[bossName]) {
                    bossStats[bossName] = {
                        total: 0,
                        orderCount: 0
                    };
                }
                
                bossStats[bossName].total += cost;
                bossStats[bossName].orderCount += 1;
            });
            
            // è½¬æ¢ä¸ºæ•°ç»„å¹¶æŒ‰æ¶ˆè´¹æ€»é¢é™åºæ’åº
            const bossStatsArray = Object.entries(bossStats)
                .map(([name, stats]) => ({
                    name,
                    total: stats.total,
                    orderCount: stats.orderCount
                }))
                .sort((a, b) => b.total - a.total);
            
            // è®¡ç®—æ‰€æœ‰è€æ¿çš„æ€»æ¶ˆè´¹
            const grandTotal = bossStatsArray.reduce((sum, boss) => sum + boss.total, 0);
            
            // åˆ›å»ºç»Ÿè®¡å¡ç‰‡
            const statsCard = document.createElement('div');
            statsCard.className = 'boss-statistics';
            
            let statsHTML = `
                <h3><i class="fas fa-chart-bar"></i> è€æ¿æ¶ˆè´¹ç»Ÿè®¡</h3>
            `;
            
            if (bossStatsArray.length === 0) {
                statsHTML += `
                    <div class="no-statistics">
                        <p>æš‚æ— æ¶ˆè´¹ç»Ÿè®¡</p>
                    </div>
                `;
            } else {
                // æ˜¾ç¤ºæ¯ä¸ªè€æ¿çš„æ¶ˆè´¹ç»Ÿè®¡
                bossStatsArray.forEach(boss => {
                    statsHTML += `
                        <div class="boss-stat-item">
                            <span class="boss-name" onclick="showBossDetails('${boss.name.replace(/'/g, "\\'")}')">
                                ${boss.name} (${boss.orderCount}å•)
                            </span>
                            <span class="boss-total">${boss.total.toFixed(2)}å…ƒ</span>
                        </div>
                    `;
                });
                
                // æ˜¾ç¤ºæ€»è®¡
                statsHTML += `
                    <div class="boss-stat-item" style="border-bottom: none; margin-top: 10px; padding-top: 10px; border-top: 2px solid rgba(255, 255, 255, 0.2);">
                        <span class="boss-name" style="font-weight: bold;">æ€»è®¡</span>
                        <span class="boss-total-amount">${grandTotal.toFixed(2)}å…ƒ</span>
                    </div>
                `;
            }
            
            statsCard.innerHTML = statsHTML;
            bossStatisticsContainer.appendChild(statsCard);
        }
        
        // æ˜¾ç¤ºæ—¶é•¿è®¡ç®—ç»“æœ
        function displayTimeResults() {
            if (!startTimeEl.value) {
                showToast('è¯·å¡«å†™å¼€å§‹æ—¶é—´', 'warning');
                return;
            }
            
            const result = calculateTimeDifference(startTimeEl.value, endTimeEl.value || null);
            
            if (result.error) {
                showToast(result.error, 'error');
                return;
            }
            
            document.getElementById('time-actual').textContent = result.actualDuration;
            document.getElementById('time-billable').textContent = result.billableHours;
            
            timeResults.style.display = 'block';
            costResults.style.display = 'none';
        }
        
        // æ˜¾ç¤ºè´¹ç”¨è®¡ç®—ç»“æœ
        function displayCostResults() {
            if (!startTimeEl.value) {
                showToast('è¯·å¡«å†™å¼€å§‹æ—¶é—´', 'warning');
                return;
            }
            
            const pricePerHour = selectedPrice || parseFloat(pricePerHourEl.value);
            
            if (!pricePerHour || pricePerHour <= 0) {
                showToast('è¯·å¡«å†™æœ‰æ•ˆçš„æ¯å°æ—¶å•ä»·', 'error');
                return;
            }
            
            const result = calculateTimeDifference(startTimeEl.value, endTimeEl.value || null);
            
            if (result.error) {
                showToast(result.error, 'error');
                return;
            }
            
            const totalCost = result.billableHoursNum * pricePerHour;
            
            document.getElementById('cost-total').textContent = `${totalCost.toFixed(2)}å…ƒ`;
            
            costResults.style.display = 'block';
            timeResults.style.display = 'none';
        }
        
        // æ·»åŠ åˆ°å¾…ç»“æŸè®¢å•
        function addToPendingOrders() {
            if (!startTimeEl.value) {
                showToast('è¯·å¡«å†™å¼€å§‹æ—¶é—´', 'warning');
                return;
            }
            
            const pricePerHour = selectedPrice || parseFloat(pricePerHourEl.value) || 0;
            const companionName = companionNameEl.value || 'æœªå¡«å†™';
            const bossName = bossNameEl.value || 'æ•£å®¢';
            const startTime = startTimeEl.value;
            const endTime = endTimeEl.value || null;
            
            // éªŒè¯æ—¶é—´
            if (endTime) {
                const start = new Date(startTime);
                const end = new Date(endTime);
                
                if (end <= start) {
                    showToast('ç»“æŸæ—¶é—´ä¸èƒ½æ—©äºå¼€å§‹æ—¶é—´', 'error');
                    return;
                }
            }
            
            const order = {
                id: Date.now(),
                pricePerHour: pricePerHour,
                companionName: companionName,
                bossName: bossName,
                startTime: startTime,
                endTime: endTime,
                status: endTime ? 'completed' : 'pending',
                createdAt: new Date().toISOString()
            };
            
            pendingOrders.push(order);
            saveToLocalStorage();
            
            updatePendingOrdersDisplay();
            updateBossStatistics();
            
            // é‡ç½®è¡¨å•
            pricePerHourEl.value = '';
            companionNameEl.value = '';
            bossNameEl.value = '';
            initializeTimes();
            timeResults.style.display = 'none';
            costResults.style.display = 'none';
            
            // é‡ç½®ä»·æ ¼æŒ‰é’®é€‰æ‹©
            priceButtons.forEach(btn => btn.classList.remove('selected'));
            selectedPrice = null;
            
            showToast('è®¢å•å·²æ·»åŠ åˆ°å¾…ç»“æŸåˆ—è¡¨ï¼', 'success');
        }
        
        // æ›´æ–°å¾…ç»“æŸè®¢å•æ˜¾ç¤º
        function updatePendingOrdersDisplay() {
            // æ¸…ç©ºå®¹å™¨
            pendingOrdersContainer.innerHTML = '';
            
            // æ›´æ–°è®¢å•æ•°é‡
            const pendingCount = pendingOrders.filter(order => !order.endTime).length;
            pendingCountEl.textContent = pendingCount > 0 ? `(${pendingCount})` : '';
            
            if (pendingOrders.length === 0) {
                const noOrdersClone = noOrdersEl.cloneNode(true);
                pendingOrdersContainer.appendChild(noOrdersClone);
                return;
            }
            
            // æŒ‰åˆ›å»ºæ—¶é—´å€’åºæ’åº
            const sortedOrders = [...pendingOrders].sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            sortedOrders.forEach(order => {
                const orderElement = createOrderElement(order);
                pendingOrdersContainer.appendChild(orderElement);
            });
        }
        
        // åˆ›å»ºè®¢å•å…ƒç´ 
        function createOrderElement(order) {
            const orderDiv = document.createElement('div');
            orderDiv.className = `order-item ${order.status === 'completed' ? 'completed' : ''}`;
            orderDiv.setAttribute('data-id', order.id);
            
            // è®¡ç®—æ—¶é•¿å’Œè´¹ç”¨
            const timeResult = calculateTimeDifference(order.startTime, order.endTime);
            const isCompleted = order.endTime !== null;
            
            let durationText = 'è¿›è¡Œä¸­';
            let billableText = 'å¾…è®¡ç®—';
            let costText = 'å¾…è®¡ç®—';
            let totalCost = 0;
            
            if (!timeResult.error && isCompleted) {
                durationText = timeResult.actualDuration;
                billableText = timeResult.billableHours;
                
                if (order.pricePerHour > 0) {
                    totalCost = timeResult.billableHoursNum * order.pricePerHour;
                    costText = `${totalCost.toFixed(2)}å…ƒ`;
                }
            } else if (!timeResult.error && !isCompleted) {
                // å¯¹äºæœªç»“æŸçš„è®¢å•ï¼Œè®¡ç®—ä»å¼€å§‹åˆ°ç°åœ¨çš„æ—¶é•¿
                const currentResult = calculateTimeDifference(order.startTime);
                durationText = `${currentResult.actualDuration} (è¿›è¡Œä¸­)`;
                billableText = currentResult.billableHours;
                
                if (order.pricePerHour > 0) {
                    totalCost = currentResult.billableHoursNum * order.pricePerHour;
                    costText = `${totalCost.toFixed(2)}å…ƒ (é¢„ä¼°)`;
                }
            }
            
            // ç”ŸæˆæŠ¥å•æ–‡æœ¬
            const copyText = generateCopyText(order, timeResult, isCompleted);
            // ç”Ÿæˆæ–°çš„æ ¼å¼åŒ–æ–‡æœ¬
            const formatText = generateFormatText(order, timeResult, totalCost);
            
            orderDiv.innerHTML = `
                <div class="order-header">
                    <div class="order-title">è®¢å• #${order.id.toString().slice(-6)}</div>
                    <div class="order-status ${isCompleted ? 'status-completed' : 'status-pending'}">
                        ${isCompleted ? 'å·²ç»“æŸ' : 'è¿›è¡Œä¸­'}
                    </div>
                </div>
                
                <div class="order-details">
                    <div class="order-detail">
                        <span class="detail-label">é™ªç©åç§°</span>
                        <span class="detail-value">${order.companionName}</span>
                    </div>
                    <div class="order-detail">
                        <span class="detail-label">è€æ¿åç§°</span>
                        <span class="detail-value">${order.bossName}</span>
                    </div>
                    <div class="order-detail">
                        <span class="detail-label">å¼€å§‹æ—¶é—´</span>
                        <span class="detail-value">${formatDateTimeForDisplay(new Date(order.startTime))}</span>
                    </div>
                    <div class="order-detail">
                        <span class="detail-label">ç»“æŸæ—¶é—´</span>
                        <span class="detail-value">${order.endTime ? formatDateTimeForDisplay(new Date(order.endTime)) : 'æœªç»“æŸ'}</span>
                    </div>
                    <div class="order-detail">
                        <span class="detail-label">å•ä»·</span>
                        <span class="detail-value">${order.pricePerHour > 0 ? `${order.pricePerHour}å…ƒ/å°æ—¶` : 'æœªè®¾ç½®'}</span>
                    </div>
                    <div class="order-detail">
                        <span class="detail-label">æ—¶é•¿</span>
                        <span class="detail-value">${durationText}</span>
                    </div>
                    <div class="order-detail">
                        <span class="detail-label">è®¡è´¹æ—¶é•¿</span>
                        <span class="detail-value">${billableText}</span>
                    </div>
                    <div class="order-detail">
                        <span class="detail-label">è´¹ç”¨</span>
                        <span class="detail-value">${costText}</span>
                    </div>
                </div>
                
                <div class="order-actions">
                    <button class="action-btn edit-btn" onclick="editOrder(${order.id})">
                        <i class="fas fa-edit"></i> ç¼–è¾‘
                    </button>
                    ${!isCompleted ? `
                        <button class="action-btn complete-btn" onclick="completeOrder(${order.id})">
                            <i class="fas fa-check-circle"></i> ç»“æŸ
                        </button>
                    ` : ''}
                    <button class="action-btn delete-btn" onclick="deleteOrder(${order.id})">
                        <i class="fas fa-trash"></i> åˆ é™¤
                    </button>
                </div>
                
                <div class="copy-text">
                    <button class="copy-btn" onclick="copyTextToClipboard(${order.id})">
                        <i class="fas fa-copy"></i> å¤åˆ¶
                    </button>
                    ${copyText}
                </div>
                
                <div class="copy-buttons">
                    <button class="copy-format-btn" onclick="copyFormatText(${order.id}, 'format1')">
                        <i class="fas fa-copy"></i> å¤åˆ¶æ ¼å¼ä¸€
                    </button>
                </div>
            `;
            
            // å­˜å‚¨æ ¼å¼åŒ–æ–‡æœ¬æ•°æ®
            orderDiv.setAttribute('data-format-text', formatText);
            
            return orderDiv;
        }
        
        // ç”ŸæˆæŠ¥å•æ–‡æœ¬ - ä½¿ç”¨å®é™…è®¡è´¹å°æ—¶æ•°
        function generateCopyText(order, timeResult, isCompleted) {
            const startDate = new Date(order.startTime);
            const month = startDate.getMonth() + 1;
            const day = startDate.getDate();
            
            const startHours = String(startDate.getHours()).padStart(2, '0');
            const startMinutes = String(startDate.getMinutes()).padStart(2, '0');
            
            let copyText = `${month}/${day}\n`;
            copyText += `å¼€å§‹æ—¶é—´ï¼š${startHours}ï¼š${startMinutes}   ${order.bossName}\n`;
            
            if (isCompleted && order.endTime && !timeResult.error) {
                const endDate = new Date(order.endTime);
                const endHours = String(endDate.getHours()).padStart(2, '0');
                const endMinutes = String(endDate.getMinutes()).padStart(2, '0');
                
                // ä½¿ç”¨è®¡è´¹å°æ—¶æ•°ï¼Œä¿ç•™1ä½å°æ•°
                const billableHours = timeResult.billableHoursNum;
                const formattedHours = billableHours % 1 === 0 ? billableHours.toFixed(0) : billableHours.toFixed(1);
                
                copyText += `ç»“æŸæ—¶é—´ï¼š${endHours}ï¼š${endMinutes}   ${formattedHours}h  ${order.pricePerHour}/h  å·²æŠ¥å¤‡`;
            }
            
            return copyText;
        }
        
        // ç”Ÿæˆæ–°çš„æ ¼å¼åŒ–æ–‡æœ¬ - å·²ä¿®æ”¹ï¼šé‡‘é¢ä¿ç•™ä¸¤ä½å°æ•°
        function generateFormatText(order, timeResult, totalCost) {
            const startDate = new Date(order.startTime);
            const year = startDate.getFullYear();
            const month = String(startDate.getMonth() + 1).padStart(2, '0');
            const day = String(startDate.getDate()).padStart(2, '0');
            const hours = String(startDate.getHours()).padStart(2, '0');
            const minutes = String(startDate.getMinutes()).padStart(2, '0');
            
            // è·å–è€æ¿åç§°ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨"æ•£å®¢"
            const bossName = order.bossName && order.bossName !== 'æœªå¡«å†™' ? order.bossName : 'æ•£å®¢';
            
            // è®¡ç®—æ€»é‡‘é¢ï¼ˆå¦‚æœæœªç»“æŸåˆ™è®¡ç®—é¢„ä¼°é‡‘é¢ï¼‰ - ä¿®æ”¹ï¼šä¿ç•™ä¸¤ä½å°æ•°
            const amount = totalCost > 0 ? totalCost.toFixed(2) : '0.00';
            
            // æ ¼å¼åŒ–æ¥å•æ—¶é—´
            const orderTime = `${year}-${month}-${day}-${hours}:${minutes}`;
            
            const formatText = `æ¥å•ç¾¤ï¼šæ«æ«ç”µç«æ´¾å•ç¾¤1\né¡¹ç›®ï¼šPUBG-${order.pricePerHour}\nè€æ¿ï¼š${bossName}\næ‰€å±äººï¼š\næ•°é‡ï¼š1\né‡‘é¢ï¼š${amount}\næ¥å¾…ï¼šxs\næ¥å•æ—¶é—´ï¼š${orderTime}`;
            
            return formatText;
        }
        
        // æ ¼å¼åŒ–æ—¥æœŸæ—¶é—´ç”¨äºæ˜¾ç¤º
        function formatDateTimeForDisplay(date) {
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            
            return `${month}-${day} ${hours}:${minutes}`;
        }
        
        // æ ¼å¼åŒ–æ—¥æœŸæ—¶é—´ç”¨äºè¾“å…¥æ¡†
        function formatDateTimeForInput(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            
            return `${year}-${month}-${day}T${hours}:${minutes}`;
        }
        
        // ============ ä¿®å¤çš„å¤åˆ¶åŠŸèƒ½å‡½æ•° ============
        
        // å¤åˆ¶æ–‡æœ¬åˆ°å‰ªè´´æ¿ - ä¿®å¤ç‰ˆæœ¬
        window.copyTextToClipboard = function(orderId) {
            try {
                // æ‰¾åˆ°å¯¹åº”çš„è®¢å•å…ƒç´ 
                const orderElement = document.querySelector(`.order-item[data-id="${orderId}"]`);
                if (!orderElement) {
                    showToast('æœªæ‰¾åˆ°è®¢å•', 'error');
                    return;
                }
                
                // æ‰¾åˆ°è®¢å•çš„å¤åˆ¶æ–‡æœ¬
                const copyTextElement = orderElement.querySelector('.copy-text');
                if (!copyTextElement) {
                    showToast('æœªæ‰¾åˆ°å¤åˆ¶æ–‡æœ¬', 'error');
                    return;
                }
                
                // æå–æ–‡æœ¬å†…å®¹ï¼Œæ’é™¤å¤åˆ¶æŒ‰é’®
                const copyBtn = copyTextElement.querySelector('.copy-btn');
                let textToCopy = copyTextElement.textContent || copyTextElement.innerText;
                
                // å¦‚æœæœ‰å¤åˆ¶æŒ‰é’®ï¼Œç§»é™¤å…¶æ–‡æœ¬
                if (copyBtn) {
                    textToCopy = textToCopy.replace(copyBtn.textContent, '').trim();
                }
                
                // ä½¿ç”¨ç°ä»£ Clipboard API
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(textToCopy).then(() => {
                        showToast('æ–‡æœ¬å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼', 'success');
                        
                        // ç»™æŒ‰é’®ä¸€ä¸ªè§†è§‰åé¦ˆ
                        if (copyBtn) {
                            const originalText = copyBtn.innerHTML;
                            copyBtn.innerHTML = '<i class="fas fa-check"></i> å·²å¤åˆ¶';
                            copyBtn.style.background = 'rgba(64, 192, 87, 0.3)';
                            copyBtn.style.borderColor = 'var(--success-color)';
                            copyBtn.style.color = 'var(--success-color)';
                            
                            setTimeout(() => {
                                copyBtn.innerHTML = originalText;
                                copyBtn.style.background = '';
                                copyBtn.style.borderColor = '';
                                copyBtn.style.color = '';
                            }, 2000);
                        }
                    }).catch(err => {
                        console.error('å¤åˆ¶å¤±è´¥:', err);
                        // å›é€€åˆ°è€æ–¹æ³•
                        fallbackCopyText(textToCopy, copyBtn);
                    });
                } else {
                    // è€æµè§ˆå™¨å›é€€æ–¹æ¡ˆ
                    fallbackCopyText(textToCopy, copyBtn);
                }
            } catch (error) {
                console.error('å¤åˆ¶è¿‡ç¨‹ä¸­å‡ºé”™:', error);
                showToast('å¤åˆ¶å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
            }
        };
        
        // è€æµè§ˆå™¨å›é€€å¤åˆ¶æ–¹æ³•
        function fallbackCopyText(text, copyBtn) {
            try {
                // åˆ›å»ºä¸€ä¸ªä¸´æ—¶textarea
                const textArea = document.createElement('textarea');
                textArea.value = text;
                textArea.style.position = 'fixed';
                textArea.style.left = '-999999px';
                textArea.style.top = '-999999px';
                document.body.appendChild(textArea);
                
                textArea.focus();
                textArea.select();
                
                const successful = document.execCommand('copy');
                document.body.removeChild(textArea);
                
                if (successful) {
                    showToast('æ–‡æœ¬å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼', 'success');
                    
                    // ç»™æŒ‰é’®ä¸€ä¸ªè§†è§‰åé¦ˆ
                    if (copyBtn) {
                        const originalText = copyBtn.innerHTML;
                        copyBtn.innerHTML = '<i class="fas fa-check"></i> å·²å¤åˆ¶';
                        copyBtn.style.background = 'rgba(64, 192, 87, 0.3)';
                        copyBtn.style.borderColor = 'var(--success-color)';
                        copyBtn.style.color = 'var(--success-color)';
                        
                            setTimeout(() => {
                                copyBtn.innerHTML = originalText;
                                copyBtn.style.background = '';
                                copyBtn.style.borderColor = '';
                                copyBtn.style.color = '';
                            }, 2000);
                        }
                    } else {
                        showToast('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©æ–‡æœ¬å¤åˆ¶', 'error');
                    }
                } catch (error) {
                    console.error('å›é€€å¤åˆ¶å¤±è´¥:', error);
                    showToast('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©æ–‡æœ¬å¤åˆ¶', 'error');
                }
            }
            
            // å¤åˆ¶æ ¼å¼æ–‡æœ¬ - ä¿®å¤ç‰ˆæœ¬
            window.copyFormatText = function(orderId, formatType) {
                try {
                    // æ‰¾åˆ°å¯¹åº”çš„è®¢å•å…ƒç´ 
                    const orderElement = document.querySelector(`.order-item[data-id="${orderId}"]`);
                    if (!orderElement) {
                        showToast('æœªæ‰¾åˆ°è®¢å•', 'error');
                        return;
                    }
                    
                    // è·å–å­˜å‚¨åœ¨dataå±æ€§ä¸­çš„æ ¼å¼æ–‡æœ¬
                    const formatText = orderElement.getAttribute('data-format-text');
                    if (!formatText) {
                        showToast('æœªæ‰¾åˆ°æ ¼å¼æ–‡æœ¬', 'error');
                        return;
                    }
                    
                    // ä½¿ç”¨ç°ä»£ Clipboard API
                    if (navigator.clipboard && navigator.clipboard.writeText) {
                        navigator.clipboard.writeText(formatText).then(() => {
                            showToast('æ ¼å¼æ–‡æœ¬å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼', 'success');
                            
                            // æ‰¾åˆ°å¯¹åº”çš„å¤åˆ¶æŒ‰é’®å¹¶ç»™è§†è§‰åé¦ˆ
                            const copyFormatBtn = orderElement.querySelector(`.copy-format-btn[onclick*="copyFormatText(${orderId}, '${formatType}')"]`);
                            if (copyFormatBtn) {
                                const originalText = copyFormatBtn.innerHTML;
                                copyFormatBtn.innerHTML = '<i class="fas fa-check"></i> å·²å¤åˆ¶';
                                copyFormatBtn.style.background = 'rgba(64, 192, 87, 0.3)';
                                copyFormatBtn.style.borderColor = 'var(--success-color)';
                                copyFormatBtn.style.color = 'var(--success-color)';
                                
                                setTimeout(() => {
                                    copyFormatBtn.innerHTML = originalText;
                                    copyFormatBtn.style.background = '';
                                    copyFormatBtn.style.borderColor = '';
                                    copyFormatBtn.style.color = '';
                                }, 2000);
                            }
                        }).catch(err => {
                            console.error('å¤åˆ¶æ ¼å¼æ–‡æœ¬å¤±è´¥:', err);
                            fallbackCopyText(formatText);
                        });
                    } else {
                        // è€æµè§ˆå™¨å›é€€æ–¹æ¡ˆ
                        fallbackCopyText(formatText);
                    }
                } catch (error) {
                    console.error('å¤åˆ¶æ ¼å¼æ–‡æœ¬è¿‡ç¨‹ä¸­å‡ºé”™:', error);
                    showToast('å¤åˆ¶å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
                }
            };
            
            // ============ ä¿®å¤çš„å¤åˆ¶åŠŸèƒ½å‡½æ•°ç»“æŸ ============
            
            // ç¼–è¾‘è®¢å•
            window.editOrder = function(id) {
                const orderIndex = pendingOrders.findIndex(order => order.id === id);
                if (orderIndex === -1) return;
                
                const order = pendingOrders[orderIndex];
                editingOrderId = id;
                editSelectedPrice = order.pricePerHour || null;
                
                // å¡«å……è¡¨å•
                editPricePerHourEl.value = order.pricePerHour || '';
                editCompanionNameEl.value = order.companionName;
                editBossNameEl.value = order.bossName;
                editStartTimeEl.value = formatDateTimeForInput(new Date(order.startTime));
                editEndTimeEl.value = order.endTime ? formatDateTimeForInput(new Date(order.endTime)) : '';
                
                // è®¾ç½®ä»·æ ¼æŒ‰é’®é€‰æ‹©çŠ¶æ€
                editPriceButtons.forEach(btn => {
                    if (parseFloat(btn.dataset.price) === order.pricePerHour) {
                        btn.classList.add('selected');
                    } else {
                        btn.classList.remove('selected');
                    }
                });
                
                // æ˜¾ç¤ºæ¨¡æ€æ¡†
                editOrderModal.style.display = 'flex';
            };
            
            // å®Œæˆè®¢å•
            window.completeOrder = function(id) {
                const orderIndex = pendingOrders.findIndex(order => order.id === id);
                if (orderIndex === -1) return;
                
                if (confirm('ç¡®å®šè¦ç»“æŸè¿™ä¸ªè®¢å•å—ï¼Ÿ')) {
                    const now = new Date();
                    const datetimeLocal = formatDateTimeForInput(now);
                    
                    pendingOrders[orderIndex].endTime = datetimeLocal;
                    pendingOrders[orderIndex].status = 'completed';
                    saveToLocalStorage();
                    updatePendingOrdersDisplay();
                    updateBossStatistics();
                    showToast('è®¢å•å·²ç»“æŸï¼', 'success');
                }
            };
            
            // åˆ é™¤è®¢å•
            window.deleteOrder = function(id) {
                if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè®¢å•å—ï¼Ÿ')) {
                    pendingOrders = pendingOrders.filter(order => order.id !== id);
                    saveToLocalStorage();
                    updatePendingOrdersDisplay();
                    updateBossStatistics();
                    showToast('è®¢å•å·²åˆ é™¤ï¼', 'success');
                }
            };
            
            // ä¿å­˜ç¼–è¾‘
            saveEditBtn.addEventListener('click', function() {
                if (!editingOrderId) return;
                
                const orderIndex = pendingOrders.findIndex(order => order.id === editingOrderId);
                if (orderIndex === -1) return;
                
                const pricePerHour = editSelectedPrice || parseFloat(editPricePerHourEl.value) || 0;
                const companionName = editCompanionNameEl.value || 'æœªå¡«å†™';
                const bossName = editBossNameEl.value || 'æ•£å®¢';
                const startTime = editStartTimeEl.value;
                const endTime = editEndTimeEl.value || null;
                
                if (endTime) {
                    const start = new Date(startTime);
                    const end = new Date(endTime);
                    
                    if (end <= start) {
                        showToast('ç»“æŸæ—¶é—´ä¸èƒ½æ—©äºå¼€å§‹æ—¶é—´', 'error');
                        return;
                    }
                }
                
                pendingOrders[orderIndex].pricePerHour = pricePerHour;
                pendingOrders[orderIndex].companionName = companionName;
                pendingOrders[orderIndex].bossName = bossName;
                pendingOrders[orderIndex].startTime = startTime;
                pendingOrders[orderIndex].endTime = endTime;
                pendingOrders[orderIndex].status = endTime ? 'completed' : 'pending';
                
                saveToLocalStorage();
                updatePendingOrdersDisplay();
                updateBossStatistics();
                
                editOrderModal.style.display = 'none';
                editingOrderId = null;
                editSelectedPrice = null;
                
                showToast('è®¢å•å·²æ›´æ–°ï¼', 'success');
            });
            
            // åœ¨ç¼–è¾‘æ¨¡æ€æ¡†ä¸­ç»“æŸè®¢å•
            editCompleteBtn.addEventListener('click', function() {
                if (!editingOrderId) return;
                
                const orderIndex = pendingOrders.findIndex(order => order.id === editingOrderId);
                if (orderIndex === -1) return;
                
                const pricePerHour = editSelectedPrice || parseFloat(editPricePerHourEl.value) || 0;
                const companionName = editCompanionNameEl.value || 'æœªå¡«å†™';
                const bossName = editBossNameEl.value || 'æ•£å®¢';
                const startTime = editStartTimeEl.value;
                
                let endTime = editEndTimeEl.value;
                
                if (!endTime) {
                    const now = new Date();
                    endTime = formatDateTimeForInput(now);
                    editEndTimeEl.value = endTime;
                }
                
                const start = new Date(startTime);
                const end = new Date(endTime);
                
                if (end <= start) {
                    showToast('ç»“æŸæ—¶é—´ä¸èƒ½æ—©äºå¼€å§‹æ—¶é—´', 'error');
                    return;
                }
                
                if (confirm('ç¡®å®šè¦ç»“æŸè¿™ä¸ªè®¢å•å—ï¼Ÿ')) {
                    pendingOrders[orderIndex].pricePerHour = pricePerHour;
                    pendingOrders[orderIndex].companionName = companionName;
                    pendingOrders[orderIndex].bossName = bossName;
                    pendingOrders[orderIndex].startTime = startTime;
                    pendingOrders[orderIndex].endTime = endTime;
                    pendingOrders[orderIndex].status = 'completed';
                    
                    saveToLocalStorage();
                    updatePendingOrdersDisplay();
                    updateBossStatistics();
                    
                    editOrderModal.style.display = 'none';
                    editingOrderId = null;
                    editSelectedPrice = null;
                    
                    showToast('è®¢å•å·²ç»“æŸï¼', 'success');
                }
            });
            
            // å…³é—­ç¼–è¾‘æ¨¡æ€æ¡†
            closeEditModalBtn.addEventListener('click', function() {
                editOrderModal.style.display = 'none';
                editingOrderId = null;
                editSelectedPrice = null;
            });
            
            cancelEditBtn.addEventListener('click', function() {
                editOrderModal.style.display = 'none';
                editingOrderId = null;
                editSelectedPrice = null;
            });
            
            // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
            editOrderModal.addEventListener('click', function(e) {
                if (e.target === editOrderModal) {
                    editOrderModal.style.display = 'none';
                    editingOrderId = null;
                    editSelectedPrice = null;
                }
            });
            
            // å…³é—­è€æ¿è¯¦æƒ…æ¨¡æ€æ¡†
            closeBossDetailModalBtn.addEventListener('click', function() {
                bossDetailModal.style.display = 'none';
            });
            
            closeBossDetailBtn.addEventListener('click', function() {
                bossDetailModal.style.display = 'none';
            });
            
            // ç‚¹å‡»è€æ¿è¯¦æƒ…æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
            bossDetailModal.addEventListener('click', function(e) {
                if (e.target === bossDetailModal) {
                    bossDetailModal.style.display = 'none';
                }
            });
            
            // ä»·æ ¼æŒ‰é’®äº‹ä»¶å¤„ç†
            priceButtons.forEach(button => {
                button.addEventListener('click', function() {
                    priceButtons.forEach(btn => btn.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedPrice = parseFloat(this.dataset.price);
                    pricePerHourEl.value = selectedPrice;
                });
            });
            
            editPriceButtons.forEach(button => {
                button.addEventListener('click', function() {
                    editPriceButtons.forEach(btn => btn.classList.remove('selected'));
                    this.classList.add('selected');
                    editSelectedPrice = parseFloat(this.dataset.price);
                    editPricePerHourEl.value = editSelectedPrice;
                });
            });
            
            // æ‰‹åŠ¨è¾“å…¥ä»·æ ¼æ—¶æ¸…é™¤æŒ‰é’®é€‰æ‹©
            pricePerHourEl.addEventListener('input', function() {
                if (this.value && parseFloat(this.value) !== selectedPrice) {
                    priceButtons.forEach(btn => btn.classList.remove('selected'));
                    selectedPrice = null;
                }
            });
            
            editPricePerHourEl.addEventListener('input', function() {
                if (this.value && parseFloat(this.value) !== editSelectedPrice) {
                    editPriceButtons.forEach(btn => btn.classList.remove('selected'));
                    editSelectedPrice = null;
                }
            });
            
            // äº‹ä»¶ç›‘å¬å™¨
            setNowBtn.addEventListener('click', function() {
                const now = new Date();
                const datetimeLocal = formatDateTimeForInput(now);
                startTimeEl.value = datetimeLocal;
                
                timeResults.style.display = 'none';
                costResults.style.display = 'none';
            });
            
            setCurrentBtn.addEventListener('click', function() {
                const now = new Date();
                const datetimeLocal = formatDateTimeForInput(now);
                endTimeEl.value = datetimeLocal;
                
                timeResults.style.display = 'none';
                costResults.style.display = 'none';
            });
            
            editSetCurrentBtn.addEventListener('click', function() {
                const now = new Date();
                const datetimeLocal = formatDateTimeForInput(now);
                editEndTimeEl.value = datetimeLocal;
            });
            
            calculateTimeBtn.addEventListener('click', displayTimeResults);
            calculateCostBtn.addEventListener('click', displayCostResults);
            addToPendingBtn.addEventListener('click', addToPendingOrders);
            
            resetBtn.addEventListener('click', function() {
                pricePerHourEl.value = '';
                companionNameEl.value = '';
                bossNameEl.value = '';
                initializeTimes();
                timeResults.style.display = 'none';
                costResults.style.display = 'none';
                
                priceButtons.forEach(btn => btn.classList.remove('selected'));
                selectedPrice = null;
                
                showToast('è¡¨å•å·²é‡ç½®', 'info');
            });
            
            // æ¸…é™¤æ‰€æœ‰è®¢å•
            document.getElementById('clear-all-btn').addEventListener('click', function() {
                if (pendingOrders.length === 0) {
                    showToast('æ²¡æœ‰è®¢å•å¯æ¸…é™¤', 'info');
                    return;
                }
                
                if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰è®¢å•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚')) {
                    pendingOrders = [];
                    saveToLocalStorage();
                    updatePendingOrdersDisplay();
                    updateBossStatistics();
                    showToast('æ‰€æœ‰è®¢å•å·²æ¸…é™¤', 'success');
                }
            });
            
            // å¯¼å‡ºæ•°æ®
            document.getElementById('export-btn').addEventListener('click', function() {
                if (pendingOrders.length === 0) {
                    showToast('æ²¡æœ‰è®¢å•å¯å¯¼å‡º', 'info');
                    return;
                }
                
                const csv = convertOrdersToCSV();
                const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `æ«æ«ç”µç«è®¢å•_${new Date().toLocaleDateString('zh-CN').replace(/\//g, '-')}.csv`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showToast('è®¢å•æ•°æ®å·²å¯¼å‡ºä¸ºCSVæ–‡ä»¶', 'success');
            });
            
            function convertOrdersToCSV() {
                let csv = 'è®¢å•ID,é™ªç©åç§°,è€æ¿åç§°,å¼€å§‹æ—¶é—´,ç»“æŸæ—¶é—´,å•ä»·,çŠ¶æ€,åˆ›å»ºæ—¶é—´,è®¡è´¹æ—¶é•¿,æ€»è´¹ç”¨\n';
                
                pendingOrders.forEach(order => {
                    const timeResult = calculateTimeDifference(order.startTime, order.endTime);
                    const totalCost = order.pricePerHour > 0 && !timeResult.error ? 
                        (timeResult.billableHoursNum * order.pricePerHour).toFixed(2) : '0.00';
                    
                    csv += `"${order.id}","${order.companionName}","${order.bossName}","${formatDateTimeForDisplay(new Date(order.startTime))}",`;
                    csv += `"${order.endTime ? formatDateTimeForDisplay(new Date(order.endTime)) : ''}","${order.pricePerHour}","${order.status}",`;
                    csv += `"${formatDateTimeForDisplay(new Date(order.createdAt))}","${timeResult.billableHours}","${totalCost}"\n`;
                });
                
                return csv;
            }
            
            // æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
            function showToast(message, type = 'info') {
                // ç§»é™¤ç°æœ‰æç¤º
                const existingToast = document.querySelector('.toast');
                if (existingToast) existingToast.remove();
                
                const toast = document.createElement('div');
                toast.className = `toast toast-${type}`;
                toast.textContent = message;
                toast.style.cssText = `
                    position: fixed;
                    top: 20px;
                    left: 50%;
                    transform: translateX(-50%);
                    background: ${type === 'success' ? 'rgba(64, 192, 87, 0.9)' : 
                               type === 'error' ? 'rgba(255, 107, 107, 0.9)' : 
                               type === 'warning' ? 'rgba(255, 204, 0, 0.9)' : 'rgba(77, 171, 247, 0.9)'};
                    color: white;
                    padding: 12px 24px;
                    border-radius: 10px;
                    z-index: 9999;
                    font-weight: 500;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                    animation: slideIn 0.3s ease;
                `;
                
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    toast.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => toast.remove(), 300);
                }, 3000);
            }
            
            // æ·»åŠ CSSåŠ¨ç”»
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { top: -50px; opacity: 0; }
                    to { top: 20px; opacity: 1; }
                }
                @keyframes slideOut {
                    from { top: 20px; opacity: 1; }
                    to { top: -50px; opacity: 0; }
                }
            `;
            document.head.appendChild(style);
            
            // é˜²æ­¢é”®ç›˜å¼¹èµ·æ—¶é¡µé¢å˜å½¢
            window.addEventListener('resize', () => {
                if (document.activeElement.tagName === 'INPUT' || document.activeElement.tagName === 'TEXTAREA') {
                    window.scrollTo(0, 0);
                }
            });
            
            // åˆå§‹åŒ–
            function init() {
                // éšè—åŠ è½½åŠ¨ç”»
                setTimeout(() => {
                    document.getElementById('loading').style.display = 'none';
                }, 500);
                
                // æ›´æ–°æ—¶é—´æ˜¾ç¤º
                updateCurrentTime();
                setInterval(updateCurrentTime, 1000);
                
                // ä»localStorageåŠ è½½æ•°æ®
                loadFromLocalStorage();
                
                // åˆå§‹åŒ–æ—¶é—´è¾“å…¥ï¼ˆä»…åœ¨è¡¨å•ä¸ºç©ºæ—¶è®¾ç½®é»˜è®¤å€¼ï¼‰
                initializeTimes();
                
                // åŠ è½½å¾…ç»“æŸè®¢å•
                updatePendingOrdersDisplay();
                
                // æ·»åŠ PWAæ”¯æŒ
                if ('serviceWorker' in navigator) {
                    navigator.serviceWorker.register('/sw.js').catch(console.error);
                }
                
                // æ·»åŠ åˆ°ä¸»å±å¹•æç¤º
                let deferredPrompt;
                window.addEventListener('beforeinstallprompt', (e) => {
                    e.preventDefault();
                    deferredPrompt = e;
                    showToast('å¯å°†æ­¤åº”ç”¨æ·»åŠ åˆ°ä¸»å±å¹•ä»¥ä¾¿å¿«é€Ÿè®¿é—®', 'info');
                });
                
                // æ·»åŠ é¡µé¢å¯è§æ€§å˜åŒ–ç›‘å¬
                document.addEventListener('visibilitychange', function() {
                    if (!document.hidden) {
                        // é¡µé¢é‡æ–°å¯è§æ—¶ï¼Œé‡æ–°ä»localStorageåŠ è½½æ•°æ®
                        loadFromLocalStorage();
                        updatePendingOrdersDisplay();
                        updateBossStatistics();
                    }
                });
                
                // æ·»åŠ beforeunloadäº‹ä»¶ï¼Œç¡®ä¿ç¦»å¼€é¡µé¢æ—¶ä¿å­˜æ•°æ®
                window.addEventListener('beforeunload', function() {
                    saveToLocalStorage();
                });
            }
            
            // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
            document.addEventListener('DOMContentLoaded', init);
        </script>
</body>
</html>
